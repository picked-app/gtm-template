___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Picked Ecommerce",
  "categories": ["SALES", "ANALYTICS", "EXPERIMENTATION"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Picked",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The Picked Ecommerce template helps you track ecommerce events and surface insights directly in Picked.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "tagId",
    "displayName": "Tag ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "This value is provided in the Picked Dashboard."
  },
  {
    "type": "SELECT",
    "name": "eventType",
    "displayName": "Event",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "page_view",
        "displayValue": "Page view (page_view)"
      },
      {
        "value": "lead_capture",
        "displayValue": "Lead capture (lead_capture)"
      },
      {
        "value": "cart_add",
        "displayValue": "Cart add (cart_add)"
      },
      {
        "value": "cart_remove",
        "displayValue": "Cart remove (cart_remove)"
      },
      {
        "value": "wishlist_add",
        "displayValue": "Wishlist add (wishlist_add)"
      },
      {
        "value": "checkout_complete",
        "displayValue": "Checkout complete (checkout_complete)"
      },
      {
        "value": "search_results_list_view",
        "displayValue": "Search results list view (search_results_list_view)"
      },
      {
        "value": "product_select",
        "displayValue": "Product select (product_select)"
      },
      {
        "value": "product_view_details",
        "displayValue": "Product view details (product_view_details)"
      },
      {
        "value": "product_list_view",
        "displayValue": "Product list view (product_list_view)"
      }
    ],
    "simpleValueType": true,
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Related Picked event name"
  },
  {
    "type": "GROUP",
    "name": "Ecommerce",
    "displayName": "Ecommerce",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "sendEcommerceData",
        "checkboxText": "Send ecommerce data",
        "simpleValueType": true,
        "defaultValue": true,
        "alwaysInSummary": true
      },
      {
        "type": "SELECT",
        "name": "ecommerceData",
        "displayName": "GA4 Enhanced Ecommerce Data",
        "macrosInSelect": true,
        "selectItems": [],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "sendEcommerceData",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "alwaysInSummary": false
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// https://developers.google.com/tag-platform/tag-manager/templates/api

const log = require('logToConsole');
const copyFromWindow = require('copyFromWindow');
const templateStorage = require('templateStorage');
const callInWindow = require('callInWindow');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');

const LOG_PREFIX = 'picked_gtm: ';

const PICKED_GTM_URL = 'https://api.picked.app/sdk/picked-gtm.js';

log(LOG_PREFIX + 'data =', data);

if (!copyFromWindow('picked_gtm')) {
  log(LOG_PREFIX + '\'picked_gtm\' is not defined in \'window\'. Creating it.');
  setInWindow('picked_gtm', []);
}

callInWindow('picked_gtm.push', data);

const onFailure = (msg) => {
  log(LOG_PREFIX + 'error: ' + msg);
  return data.gtmOnFailure();
};

const onSuccess = () => {
  log(LOG_PREFIX + 'success');
  return data.gtmOnSuccess();
};


injectScript(PICKED_GTM_URL, onSuccess, onFailure, 'picked_gtm');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "picked_gtm"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "picked_gtm.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://api.picked.app/sdk/picked-gtm.js"
              },
              {
                "type": 1,
                "string": "https://*.convincely.io/sdk/picked-gtm.js?x-vercel-protection-bypass\u003d*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 20/01/2025, 16:58:48


